/*******************************************************************************
********************************************************************************
**
** File Name
** ---------
**
** MB.H
**
********************************************************************************
********************************************************************************
**
** Description
** -----------
** Header file for Modbus Protocol Driver
**
**
********************************************************************************
********************************************************************************
**
** Services List
** -------------
**
** Public Services:
**
**    MB_SetTimeout           -  Initiates the modbus protocol variables
**    MB_SendModbusMessage    -  Sends a Modbus message on the net
**
**
********************************************************************************
********************************************************************************
**                                                                            **
** COPYRIGHT NOTIFICATION (c) 1995,96,97,98,99 HMS Fieldbus Systems AB.       **
**                                                                            **
** This program is the property of HMS Fieldbus Systems AB.                   **
** It may not be reproduced, distributed, or used without permission          **
** of an authorised company official.                                         **
**                                                                            **
********************************************************************************
********************************************************************************
**
** Company: HMS Fieldbus Systems AB
**          Pilefeltsgatan 93-95
**          S-302 50  Halmstad
**          SWEDEN
**          Tel:     +46 (0)35 - 17 29 00
**          Fax:     +46 (0)35 - 17 29 09
**          e-mail:  info@hms.se
**
********************************************************************************
********************************************************************************
*/

/*******************************************************************************
********************************************************************************
**
** Change Log
** ----------
**
** Latest Revision:
**
**    Rev 0.10    13 jun 2002   Created
**    Rev 1.00    12 jul 2002   First Release
**
********************************************************************************
********************************************************************************
*/

#ifndef MB_H
#define MB_H



/*******************************************************************************
**
** Constants
**
********************************************************************************
*/

/*------------------------------------------------------------------------------
**
** MB_DEFAULT_TIMEOUT
**
** Defines the default timeout for response in uSec
**
**------------------------------------------------------------------------------
*/

#define MB_DEFAULT_TIMEOUT  60000



/*******************************************************************************
**
** Public Globals
**
********************************************************************************
*/

/*------------------------------------------------------------------------------
**
** MB_bCRCCounter
**
**------------------------------------------------------------------------------
**
** Total number of crc error counter
**
**------------------------------------------------------------------------------
*/

extern UINT8 MB_bCRCCounter;


/*------------------------------------------------------------------------------
**
** MB_bTimeOutCounter
**
**------------------------------------------------------------------------------
**
** Total number of timeout error counter
**
**------------------------------------------------------------------------------
*/

extern UINT8 MB_bTimeOutCounter;


/*******************************************************************************
**
** Private Globals
**
********************************************************************************
*/

/*------------------------------------------------------------------------------
**
** MB_iTimeOutTime
**
**------------------------------------------------------------------------------
**
** Response timout time
**
**------------------------------------------------------------------------------
*/

extern UINT16 MB_iTimeOutTime;


/*******************************************************************************
**
** Public Services Definitions
**
********************************************************************************
*/

/*------------------------------------------------------------------------------
**
** MB_SetTimeout()
**
** Sets the Modbus timeout for response
**
**------------------------------------------------------------------------------
**
** Inputs:
**    iTime         - New Modbus repsonse timeout time
**
** Outputs:
**    None
**
** Usage:
**    MB_SetTimeout( iTimeoutTime );
**
**------------------------------------------------------------------------------
*/

void MB_SetTimeout( UINT16 iTime );


/*------------------------------------------------------------------------------
**
** MB_SendRecModbusMessage()
**
** Adds CRC and sends a Modbus message on the serial interface and waits
** for a response. If no response is received in the timeout time the
** received size is set to zero.
**
**------------------------------------------------------------------------------
**
** Inputs:
**    pbData      - Message to send ( without CRC )
**    bSize       - The size of the message to send.
**    pbResponse  - Pointer to where to put the response
**
** Outputs:
**    pbResponse  - Response data from Modbus Slave
**    Return      - Size of the response message
**
** Usage:
**    iResponSize = MB_SendModbusMessage( abRequest, iReqSize, abResponse );
**
**------------------------------------------------------------------------------
*/

UINT8 MB_SendRecModbusMessage( UINT8* pbData,
                               UINT8 bSize,
                               UINT8* pbResponse );


#endif  /* inclusion lock */

/*******************************************************************************
**
** End of MB.H
**
********************************************************************************
*/