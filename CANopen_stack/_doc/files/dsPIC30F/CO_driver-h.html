<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><title>CO_driver.h</title><link rel="stylesheet" type="text/css" href="../../styles/main.css"><script language=JavaScript src="../../javascript/main.js"></script><script language=JavaScript src="../../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.4 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CFile"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="CO_driver.h"></a>CO_driver.h</h1><div class=CBody><p>CAN module object for Microchip dsPIC30F and Microchip C30 compiler (&gt;= V3.00).</p><p>Copyright &copy; 2004-2010 Janez Paternoster</p><p>License: GNU Lesser General Public License (LGPL).</p><p><a href="http://canopennode.sourceforge.net" class=LURL target=_top>http://canopennode.sourceforge.net</a></p><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#CO_driver.h" >CO_driver.h</a></td><td class=SDescription>CAN module object for Microchip dsPIC30F and Microchip C30 compiler (&gt;= V3.00).</td></tr><tr class="SGeneric SMarked"><td class=SEntry><a href="#Reception_of_CAN_messages" >Reception of CAN messages</a></td><td class=SDescription>Received message is processed by <a href="#Receive_CAN_message_function" class=LFunction id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">Receive CAN message function</a>.</td></tr><tr class="SGeneric"><td class=SEntry><a href="#Transmission_of_CAN_messages" >Transmission of CAN messages</a></td><td class=SDescription>CAN device has number of transmit buffers equal to number of different CANopen transmitting objects. </td></tr><tr class="SGroup"><td class=SEntry><a href="#Constants" >Constants</a></td><td class=SDescription></td></tr><tr class="SConstant SIndent1 SMarked"><td class=SEntry><a href="#CANopen_basic_data_types" >CANopen basic data types</a></td><td class=SDescription></td></tr><tr class="SConstant SIndent1"><td class=SEntry><a href="#CO_ReturnError" >CO_ReturnError</a></td><td class=SDescription>Return values of most CANopen functions. </td></tr><tr class="SConstant SIndent1 SMarked"><td class=SEntry><a href="#Retentive_memory_usage" >Retentive memory usage</a></td><td class=SDescription></td></tr><tr class="SConstant SIndent1"><td class=SEntry><a href="#Peripheral_addresses" >Peripheral addresses</a></td><td class=SDescription></td></tr><tr class="SGroup"><td class=SEntry><a href="#Macros" >Macros</a></td><td class=SDescription></td></tr><tr class="SMacro SIndent1 SMarked"><td class=SEntry><a href="#Masking_interrupts" >Masking interrupts</a></td><td class=SDescription>Interrupt masking is used to protect critical sections.</td></tr><tr class="SMacro SIndent1"><td class=SEntry><a href="#CAN_bit_rates" >CAN bit rates</a></td><td class=SDescription>CAN bit rates are initializers for array of eight <a href="#CO_CANbitRateData_t" class=LVariable id=link2 onMouseOver="ShowTip(event, 'tt2', 'link2')" onMouseOut="HideTip('tt2')">CO_CANbitRateData_t</a> objects.</td></tr><tr class="SGroup"><td class=SEntry><a href="#Variables" >Variables</a></td><td class=SDescription></td></tr><tr class="SVariable SIndent1 SMarked"><td class=SEntry><a href="#CO_CANbitRateData_t" id=link3 onMouseOver="ShowTip(event, 'tt2', 'link3')" onMouseOut="HideTip('tt2')">CO_CANbitRateData_t</a></td><td class=SDescription>Structure contains timing coefficients for CAN module. </td></tr><tr class="SVariable SIndent1"><td class=SEntry><a href="#CO_CANrxMsg_t" id=link4 onMouseOver="ShowTip(event, 'tt3', 'link4')" onMouseOut="HideTip('tt3')">CO_CANrxMsg_t</a></td><td class=SDescription>CAN receive message structure as aligned in CAN module. </td></tr><tr class="SVariable SIndent1 SMarked"><td class=SEntry><a href="#CO_CANrxArray_t" id=link5 onMouseOver="ShowTip(event, 'tt4', 'link5')" onMouseOut="HideTip('tt4')">CO_CANrxArray_t</a></td><td class=SDescription>Array for handling received CAN messages.</td></tr><tr class="SVariable SIndent1"><td class=SEntry><a href="#CO_CANtxArray_t" id=link6 onMouseOver="ShowTip(event, 'tt5', 'link6')" onMouseOut="HideTip('tt5')">CO_CANtxArray_t</a></td><td class=SDescription>Array for handling transmitting CAN messages.</td></tr><tr class="SVariable SIndent1 SMarked"><td class=SEntry><a href="#CO_CANmodule_t" id=link7 onMouseOver="ShowTip(event, 'tt6', 'link7')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a></td><td class=SDescription>Object controls CAN module.</td></tr><tr class="SGroup"><td class=SEntry><a href="#Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#memcpySwapN" >memcpySwapN</a></td><td class=SDescription>Copy N data bytes from source to destination. </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#Receive_CAN_message_function" >Receive CAN message function</a></td><td class=SDescription>Process received CAN message.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#CO_CANsetConfigurationMode" id=link8 onMouseOver="ShowTip(event, 'tt7', 'link8')" onMouseOut="HideTip('tt7')">CO_CANsetConfigurationMode</a></td><td class=SDescription>Requests CAN configuration (stopped) mode and <b>wait</b> untill it is set.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#CO_CANsetNormalMode" id=link9 onMouseOver="ShowTip(event, 'tt8', 'link9')" onMouseOut="HideTip('tt8')">CO_CANsetNormalMode</a></td><td class=SDescription>Requests CAN normal (opearational) mode and <b>wait</b> untill it is set.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#CO_CANmodule_init" id=link10 onMouseOver="ShowTip(event, 'tt9', 'link10')" onMouseOut="HideTip('tt9')">CO_CANmodule_init</a></td><td class=SDescription>Initialize CAN module object.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#CO_CANmodule_delete" id=link11 onMouseOver="ShowTip(event, 'tt10', 'link11')" onMouseOut="HideTip('tt10')">CO_CANmodule_delete</a></td><td class=SDescription>Delete CANmodule object and free memory.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#CO_CANrxMsg_readIdent" id=link12 onMouseOver="ShowTip(event, 'tt11', 'link12')" onMouseOut="HideTip('tt11')">CO_CANrxMsg_readIdent</a></td><td class=SDescription>Reads CAN identifier from received message.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#CO_CANrxBufferInit" id=link13 onMouseOver="ShowTip(event, 'tt12', 'link13')" onMouseOut="HideTip('tt12')">CO_CANrxBufferInit</a></td><td class=SDescription>Configure CAN message receive buffer.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#CO_CANtxBufferInit" id=link14 onMouseOver="ShowTip(event, 'tt13', 'link14')" onMouseOut="HideTip('tt13')">CO_CANtxBufferInit</a></td><td class=SDescription>Configure CAN message transmit buffer.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#CO_CANsend" id=link15 onMouseOver="ShowTip(event, 'tt14', 'link15')" onMouseOut="HideTip('tt14')">CO_CANsend</a></td><td class=SDescription>Send CAN message.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#CO_CANclearPendingSyncPDOs" id=link16 onMouseOver="ShowTip(event, 'tt15', 'link16')" onMouseOut="HideTip('tt15')">CO_CANclearPendingSyncPDOs</a></td><td class=SDescription>Clear all synchronous TPDOs from CAN module transmit buffers.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#CO_CANverifyErrors" id=link17 onMouseOver="ShowTip(event, 'tt16', 'link17')" onMouseOut="HideTip('tt16')">CO_CANverifyErrors</a></td><td class=SDescription>Verify all errors of CAN module.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#CO_CANinterrupt" id=link18 onMouseOver="ShowTip(event, 'tt17', 'link18')" onMouseOut="HideTip('tt17')">CO_CANinterrupt</a></td><td class=SDescription>CAN interrupt receives and transmits CAN messages.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#CO_ODF" >CO_ODF</a></td><td class=SDescription>Default function for SDO server access of variables from Object Dictionary.</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Reception_of_CAN_messages"></a>Reception of CAN messages</h3><div class=CBody><p>Received message is processed by <a href="#Receive_CAN_message_function" class=LFunction id=link19 onMouseOver="ShowTip(event, 'tt1', 'link19')" onMouseOut="HideTip('tt1')">Receive CAN message function</a>.</p><p>CAN device has number of receive buffers equal to number of different CANopen receiving objects.&nbsp; Each buffer accepts CAN messages with specific identifier (which can also be masked).&nbsp; If CAN message is accepted by specific buffer, then function pointed by <u>pFunct</u> is called with two parameters: pointer to object and pointer to received mesaage.&nbsp; Function is valid for specific CANopen object and it copies contents from received message into variables inside object.&nbsp; For more information see <a href="#Receive_CAN_message_function" class=LFunction id=link20 onMouseOver="ShowTip(event, 'tt1', 'link20')" onMouseOut="HideTip('tt1')">Receive CAN message function</a> and <a href="#CO_CANrxBufferInit" class=LFunction id=link21 onMouseOver="ShowTip(event, 'tt12', 'link21')" onMouseOut="HideTip('tt12')">CO_CANrxBufferInit</a> functions.</p><p>Benefits of this principle are: fast response, low memory usage and very high flexibility.</p></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Transmission_of_CAN_messages"></a>Transmission of CAN messages</h3><div class=CBody><p>CAN device has number of transmit buffers equal to number of different CANopen transmitting objects.&nbsp; Buffers are stored inside <a href="#CO_CANmodule_t" class=LVariable id=link22 onMouseOver="ShowTip(event, 'tt6', 'link22')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a> as members of <a href="#CO_CANtxArray_t" class=LVariable id=link23 onMouseOver="ShowTip(event, 'tt5', 'link23')" onMouseOut="HideTip('tt5')">CO_CANtxArray_t</a>.</p><p>Each buffer must be configured with <a href="#CO_CANtxBufferInit" class=LFunction id=link24 onMouseOver="ShowTip(event, 'tt13', 'link24')" onMouseOut="HideTip('tt13')">CO_CANtxBufferInit</a> function before it is used.&nbsp; Function returns pointer to 8 byte CAN data buffer which should be populated before CAN message is sent.</p><p>CANmessage is send with calling <a href="#CO_CANsend" class=LFunction id=link25 onMouseOver="ShowTip(event, 'tt14', 'link25')" onMouseOut="HideTip('tt14')">CO_CANsend</a> function, which accepts two argument: pointer to CAN device and pointer to tx buffer returned by <a href="#CO_CANtxBufferInit" class=LFunction id=link26 onMouseOver="ShowTip(event, 'tt13', 'link26')" onMouseOut="HideTip('tt13')">CO_CANtxBufferInit</a> function.&nbsp; If any hardware CAN transmit buffer is free, message is copied directly to CAN module and <u>bufferFull</u> variable from <a href="#CO_CANtxArray_t" class=LVariable id=link27 onMouseOver="ShowTip(event, 'tt5', 'link27')" onMouseOut="HideTip('tt5')">CO_CANtxArray_t</a> stays false.&nbsp; If no hardware CAN transmit buffer is free, <a href="#CO_CANsend" class=LFunction id=link28 onMouseOver="ShowTip(event, 'tt14', 'link28')" onMouseOut="HideTip('tt14')">CO_CANsend</a> function sets <u>bufferFull</u> to true; message will be then sent by CAN TX interrupt.&nbsp; Until message is not copied to CAN module, its contents must not change.</p><h4 class=CHeading>Advantages of this principle</h4><ul><li>Code for transmission of messages is very fast.</li><li>Higher priority messages are transmited first.</li><li>Buffer full is indicated only on the individual messages.&nbsp; Other buffers may be still free.</li></ul></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Constants"></a>Constants</h3></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="CANopen_basic_data_types"></a>CANopen basic data types</h3><div class=CBody><h4 class=CHeading>For dsPIC30F with Microchip C30</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry><a name="CO_OD_ROM_IDENT"></a>CO_OD_ROM_IDENT</td><td class=CDLDescription>Identifier for CO_OD_ROM varibbles is &lsquo;const&rsquo;, so variables are stored in program flash.</td></tr><tr><td class=CDLEntry><a name="UNSIGNED8"></a>UNSIGNED8</td><td class=CDLDescription>Of type unsigned char</td></tr><tr><td class=CDLEntry><a name="UNSIGNED16"></a>UNSIGNED16</td><td class=CDLDescription>Of type unsigned int</td></tr><tr><td class=CDLEntry><a name="UNSIGNED32"></a>UNSIGNED32</td><td class=CDLDescription>Of type unsigned long int</td></tr><tr><td class=CDLEntry><a name="UNSIGNED64"></a>UNSIGNED64</td><td class=CDLDescription>Of type unsigned long long int</td></tr><tr><td class=CDLEntry><a name="INTEGER8"></a>INTEGER8</td><td class=CDLDescription>Of type char</td></tr><tr><td class=CDLEntry><a name="INTEGER16"></a>INTEGER16</td><td class=CDLDescription>Of type int</td></tr><tr><td class=CDLEntry><a name="INTEGER32"></a>INTEGER32</td><td class=CDLDescription>Of type long</td></tr><tr><td class=CDLEntry><a name="INTEGER64"></a>INTEGER64</td><td class=CDLDescription>Of type long long int</td></tr><tr><td class=CDLEntry><a name="REAL32"></a>REAL32</td><td class=CDLDescription>Of type float</td></tr><tr><td class=CDLEntry><a name="REAL64"></a>REAL64</td><td class=CDLDescription>Of type long double</td></tr><tr><td class=CDLEntry><a name="VISIBLE_STRING"></a>VISIBLE_STRING</td><td class=CDLDescription>Of type char</td></tr><tr><td class=CDLEntry><a name="OCTET_STRING"></a>OCTET_STRING</td><td class=CDLDescription>Of type unsigned char</td></tr><tr><td class=CDLEntry><a name="DOMAIN"></a>DOMAIN</td><td class=CDLDescription>Application specific</td></tr></table></div></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="CO_ReturnError"></a>CO_ReturnError</h3><div class=CBody><p>Return values of most CANopen functions.&nbsp; If function was executed successfully it returns 0 otherwise it returns &lt;0.</p><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry><a name="0=CO_ERROR_NO"></a>0 = CO_ERROR_NO</td><td class=CDLDescription>Operation completed successfully.</td></tr><tr><td class=CDLEntry><a name="-1=CO_ERROR_ILLEGAL_ARGUMENT"></a>-1 = CO_ERROR_ILLEGAL_ARGUMENT</td><td class=CDLDescription>Error in function arguments.</td></tr><tr><td class=CDLEntry><a name="-2=CO_ERROR_OUT_OF_MEMORY"></a>-2 = CO_ERROR_OUT_OF_MEMORY</td><td class=CDLDescription>Memory allocation failed.</td></tr><tr><td class=CDLEntry><a name="-3=CO_ERROR_TIMEOUT"></a>-3 = CO_ERROR_TIMEOUT</td><td class=CDLDescription>Function timeout.</td></tr><tr><td class=CDLEntry><a name="-4=CO_ERROR_ILLEGAL_BAUDRATE"></a>-4 = CO_ERROR_ILLEGAL_BAUDRATE</td><td class=CDLDescription>Illegal baudrate passed to function <a href="#CO_CANmodule_init" class=LFunction id=link29 onMouseOver="ShowTip(event, 'tt9', 'link29')" onMouseOut="HideTip('tt9')">CO_CANmodule_init</a></td></tr><tr><td class=CDLEntry><a name="-5=CO_ERROR_RX_OVERFLOW"></a>-5 = CO_ERROR_RX_OVERFLOW</td><td class=CDLDescription>Previous message was not processed yet.</td></tr><tr><td class=CDLEntry><a name="-6=CO_ERROR_RX_PDO_OWERFLOW"></a>-6 = CO_ERROR_RX_PDO_OWERFLOW</td><td class=CDLDescription>previous PDO was not processed yet.</td></tr><tr><td class=CDLEntry><a name="-7=CO_ERROR_RX_MSG_LENGTH"></a>-7 = CO_ERROR_RX_MSG_LENGTH</td><td class=CDLDescription>Wrong receive message length.</td></tr><tr><td class=CDLEntry><a name="-8=CO_ERROR_RX_PDO_LENGTH"></a>-8 = CO_ERROR_RX_PDO_LENGTH</td><td class=CDLDescription>Wrong receive PDO length.</td></tr><tr><td class=CDLEntry><a name="-9=CO_ERROR_TX_OVERFLOW"></a>-9 = CO_ERROR_TX_OVERFLOW</td><td class=CDLDescription>Previous message is still waiting, buffer full.</td></tr><tr><td class=CDLEntry><a name="-10=CO_ERROR_TX_PDO_WINDOW"></a>-10 = CO_ERROR_TX_PDO_WINDOW</td><td class=CDLDescription>Synchronous TPDO is outside window.</td></tr><tr><td class=CDLEntry><a name="-11=CO_ERROR_TX_UNCONFIGURED"></a>-11 = CO_ERROR_TX_UNCONFIGURED</td><td class=CDLDescription>Transmit buffer was not confugured properly.</td></tr></table></div></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="Retentive_memory_usage"></a>Retentive memory usage</h3><div class=CBody><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry><a name="CO_USE_FLASH_WRITE"></a>CO_USE_FLASH_WRITE</td><td class=CDLDescription>If defined, then <a href="memcpyram2flash-h.html#memcpyram2flash" class=LFunction id=link30 onMouseOver="ShowTip(event, 'tt18', 'link30')" onMouseOut="HideTip('tt18')">memcpyram2flash</a> will be used to save ROM variables from Object Dictionary into internal flash memory.&nbsp; (EEPROM variables are handled by <a href="../BECK_SC2x3/eeprom-h.html#EEPROM" class=LGeneric id=link31 onMouseOver="ShowTip(event, 'tt19', 'link31')" onMouseOut="HideTip('tt19')">EEPROM</a> object.)</td></tr></table></div></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="Peripheral_addresses"></a>Peripheral addresses</h3><div class=CBody><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry><a name="ADDR_CAN1"></a>ADDR_CAN1</td><td class=CDLDescription>Starting address of CAN module 1 registers.</td></tr><tr><td class=CDLEntry><a name="ADDR_CAN2"></a>ADDR_CAN2</td><td class=CDLDescription>Starting address of CAN module 2 registers.</td></tr></table></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Macros"></a>Macros</h3></div></div>

<div class="CMacro"><div class=CTopic><h3 class=CTitle><a name="Masking_interrupts"></a>Masking interrupts</h3><div class=CBody><p>Interrupt masking is used to protect critical sections.</p><p>It is used in few places in library to protect short sections of code.</p><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry><a name="DISABLE_INTERRUPTS"></a>DISABLE_INTERRUPTS()</td><td class=CDLDescription>Disable all interrupts.</td></tr><tr><td class=CDLEntry><a name="ENABLE_INTERRUPTS"></a>ENABLE_INTERRUPTS()</td><td class=CDLDescription>Reenable interrupts.</td></tr></table></div></div></div>

<div class="CMacro"><div class=CTopic><h3 class=CTitle><a name="CAN_bit_rates"></a>CAN bit rates</h3><div class=CBody><p>CAN bit rates are initializers for array of eight <a href="#CO_CANbitRateData_t" class=LVariable id=link32 onMouseOver="ShowTip(event, 'tt2', 'link32')" onMouseOut="HideTip('tt2')">CO_CANbitRateData_t</a> objects.</p><p>Macros are not used by driver itself, they may be used by application with combination with object <a href="#CO_CANbitRateData_t" class=LVariable id=link33 onMouseOver="ShowTip(event, 'tt2', 'link33')" onMouseOut="HideTip('tt2')">CO_CANbitRateData_t</a>.&nbsp; Application must declare following global variable depending on CO_FCY used: const CO_CANbitRateData_t  CO_CANbitRateData[8] = {CO_CANbitRateDataInitializers};</p><p>There are initializers for eight objects, which corresponds to following CAN bit rates (in kbps): 10, 20, 50, 125, 250, 500, 800, 1000.</p><p>CO_FCY is internal instruction cycle clock frequency in kHz units.&nbsp; It is calculated from oscillator frequency (FOSC [in kHz]) and PLL mode:</p><ul><li>If PLL is not used -&gt; FCY = FOSC / 4,</li><li>If PLL x 4 is used -&gt; FCY = FOSC,</li><li>If PLL x 16 is used -&gt; FCY = FOSC * 4</li></ul><h4 class=CHeading>Possible values for FCY are (in three groups)</h4><ul><li>Optimal CAN bit timing on all Baud Rates: 4000, 6000, 16000, 24000.</li><li>Not so optimal CAN bit timing on all Baud Rates: 2000, 8000.</li><li>not all CANopen Baud Rates possible: 1000, 1500, 2500, 3000, 5000, 10000, 12000, 20000, 28000, 30000, 1843 (internal FRC, no PLL), 7372 (internal FRC + 4*PLL).</li></ul></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Variables"></a>Variables</h3></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="CO_CANbitRateData_t"></a>CO_CANbitRateData_t</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED8 scale; UNSIGNED8 BRP; UNSIGNED8 SJW; UNSIGNED8 PROP; UNSIGNED8 phSeg1; UNSIGNED8 phSeg2; }CO_CANbitRateData_t</td></tr></table></blockquote><p>Structure contains timing coefficients for CAN module.&nbsp; See <a href="#CAN_bit_rates" class=LMacro id=link34 onMouseOver="ShowTip(event, 'tt20', 'link34')" onMouseOut="HideTip('tt20')">CAN bit rates</a>.</p><h4 class=CHeading>CAN baud rate is calculated from following equations</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>FCAN = FCY * Scale</td><td class=CDLDescription>Input frequency to CAN module (MAX 30MHz for dsPIC30F)</td></tr><tr><td class=CDLEntry>TQ = 2 * BRP / FCAN</td><td class=CDLDescription>Time Quanta</td></tr><tr><td class=CDLEntry>BaudRate = 1 / (TQ * K)</td><td class=CDLDescription>Can bus Baud Rate</td></tr><tr><td class=CDLEntry>K = SJW + PROP + PhSeg1 + PhSeg2</td><td class=CDLDescription>Number of Time Quantas</td></tr></table><h4 class=CHeading>Variables</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>scale</td><td class=CDLDescription>(1 or 4) Scales FCY clock - dsPIC30F specific.</td></tr><tr><td class=CDLEntry>BRP</td><td class=CDLDescription>(1...64) Baud Rate Prescaler.</td></tr><tr><td class=CDLEntry>SJW</td><td class=CDLDescription>(1...4) SJW time.</td></tr><tr><td class=CDLEntry>PROP</td><td class=CDLDescription>(1...8) PROP time.</td></tr><tr><td class=CDLEntry>PhSeg1</td><td class=CDLDescription>(1...8) Phase Segment 1 time.</td></tr><tr><td class=CDLEntry>PhSeg2</td><td class=CDLDescription>(1...8) Phase Segment 2 time.</td></tr></table></div></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="CO_CANrxMsg_t"></a>CO_CANrxMsg_t</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED16 ident; UNSIGNED16 extIdent; UNSIGNED16 DLC :4; UNSIGNED16 DLCrest :12; UNSIGNED8 data[8]; UNSIGNED16 CON; }CO_CANrxMsg_t</td></tr></table></blockquote><p>CAN receive message structure as aligned in CAN module.&nbsp; Object is passed to <a href="#Receive_CAN_message_function" class=LFunction id=link35 onMouseOver="ShowTip(event, 'tt1', 'link35')" onMouseOut="HideTip('tt1')">Receive CAN message function</a>.&nbsp; In general, that function only uses <u>DLC</u> and <u>data</u> parameters.&nbsp; If it needs to read identifier, it must use function <a href="#CO_CANrxMsg_readIdent" class=LFunction id=link36 onMouseOver="ShowTip(event, 'tt11', 'link36')" onMouseOut="HideTip('tt11')">CO_CANrxMsg_readIdent</a>.</p><h4 class=CHeading>Variables</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>ident</td><td class=CDLDescription>Standard Identifier as aligned in CAN module.&nbsp; 16 bits: &lsquo;UUUSSSSS SSSSSSRE&rsquo; (U: unused; S: SID; R=SRR; E=IDE).</td></tr><tr><td class=CDLEntry>extIdent</td><td class=CDLDescription>Extended identifier, not used here</td></tr><tr><td class=CDLEntry>DLC</td><td class=CDLDescription>Data length code (bits 0...3).</td></tr><tr><td class=CDLEntry>DLCrest</td><td class=CDLDescription>Not used here (bits 4..15).</td></tr><tr><td class=CDLEntry>data</td><td class=CDLDescription>8 data bytes.</td></tr><tr><td class=CDLEntry>CON</td><td class=CDLDescription>Control word.</td></tr></table></div></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="CO_CANrxArray_t"></a>CO_CANrxArray_t</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED16 ident; UNSIGNED16 mask; void *object; INTEGER16 (*pFunct)(void *object, CO_CANrxMsg_t *message); }CO_CANrxArray_t</td></tr></table></blockquote><p>Array for handling received CAN messages.</p><h4 class=CHeading>Variables</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>ident</td><td class=CDLDescription>Standard Identifier as aligned in CAN module.</td></tr><tr><td class=CDLEntry>mask</td><td class=CDLDescription>Standard Identifier mask as aligned in CAN module.</td></tr><tr><td class=CDLEntry>object</td><td class=CDLDescription>See parameters in <a href="#CO_CANrxBufferInit" class=LFunction id=link37 onMouseOver="ShowTip(event, 'tt12', 'link37')" onMouseOut="HideTip('tt12')">CO_CANrxBufferInit</a>.</td></tr><tr><td class=CDLEntry>pFunct</td><td class=CDLDescription>See parameters in <a href="#CO_CANrxBufferInit" class=LFunction id=link38 onMouseOver="ShowTip(event, 'tt12', 'link38')" onMouseOut="HideTip('tt12')">CO_CANrxBufferInit</a>.</td></tr></table></div></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="CO_CANtxArray_t"></a>CO_CANtxArray_t</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED16 ident; UNSIGNED8 DLC; UNSIGNED8 data[8]; volatile UNSIGNED8 bufferFull; volatile UNSIGNED8 syncFlag; }CO_CANtxArray_t</td></tr></table></blockquote><p>Array for handling transmitting CAN messages.</p><h4 class=CHeading>Variables</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>ident</td><td class=CDLDescription>Standard Identifier as aligned in CAN module.&nbsp; 16 bits: &lsquo;SSSSSUUU SSSSSSRE&rsquo; (U: unused; S: SID; R=SRR; E=IDE).</td></tr><tr><td class=CDLEntry>DLC</td><td class=CDLDescription>Data length code.</td></tr><tr><td class=CDLEntry>data</td><td class=CDLDescription>8 data bytes.</td></tr><tr><td class=CDLEntry>bufferFull</td><td class=CDLDescription>Previous message is still in buffer.</td></tr><tr><td class=CDLEntry>syncFlag</td><td class=CDLDescription>Synchronous PDO messages has this flag set.&nbsp; It prevents them to be sent outside the synchronous window.</td></tr></table></div></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="CO_CANmodule_t"></a>CO_CANmodule_t</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED16 CANbaseAddress; CO_CANrxArray_t *rxArray; UNSIGNED16 rxSize; CO_CANtxArray_t *txArray; UNSIGNED16 txSize; volatile UNSIGNED8 *curentSyncTimeIsInsideWindow; volatile UNSIGNED8 bufferInhibitFlag; volatile UNSIGNED8 transmittingAborted; volatile UNSIGNED8 firstCANtxMessage; volatile UNSIGNED16 CANtxCount; UNSIGNED8 errOld; void *EM; }CO_CANmodule_t</td></tr></table></blockquote><p>Object controls CAN module.</p><h4 class=CHeading>Variables</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANbaseAddress</td><td class=CDLDescription>See parameters in <a href="#CO_CANmodule_init" class=LFunction id=link39 onMouseOver="ShowTip(event, 'tt9', 'link39')" onMouseOut="HideTip('tt9')">CO_CANmodule_init</a>.</td></tr><tr><td class=CDLEntry>rxArray</td><td class=CDLDescription>Array for handling received CAN messages.&nbsp; See <a href="#CO_CANrxArray_t" class=LVariable id=link40 onMouseOver="ShowTip(event, 'tt4', 'link40')" onMouseOut="HideTip('tt4')">CO_CANrxArray_t</a>.</td></tr><tr><td class=CDLEntry>rxSize</td><td class=CDLDescription>Size of above array is equal to number of receiving CAN objects.</td></tr><tr><td class=CDLEntry>txArray</td><td class=CDLDescription>Array for handling transmitting CAN messages.&nbsp; See <a href="#CO_CANtxArray_t" class=LVariable id=link41 onMouseOver="ShowTip(event, 'tt5', 'link41')" onMouseOut="HideTip('tt5')">CO_CANtxArray_t</a>.</td></tr><tr><td class=CDLEntry>txSize</td><td class=CDLDescription>Size of above array is equal to number of transmitting CAN objects.</td></tr><tr><td class=CDLEntry>curentSyncTimeIsInsideWindow</td><td class=CDLDescription>Pointer to variable with same name inside <a href="../CO_SYNC-h.html#CO_SYNC_t" class=LVariable id=link42 onMouseOver="ShowTip(event, 'tt21', 'link42')" onMouseOut="HideTip('tt21')">CO_SYNC_t</a> object.&nbsp; This pointer is configured inside <a href="../CO_SYNC-h.html#CO_SYNC_init" class=LFunction id=link43 onMouseOver="ShowTip(event, 'tt22', 'link43')" onMouseOut="HideTip('tt22')">CO_SYNC_init</a> function.</td></tr><tr><td class=CDLEntry>bufferInhibitFlag</td><td class=CDLDescription>If flag is true, then message in transmitt buffer is synchronous PDO message, which will be aborted, if &lt;CO_clearPendingSyncPDOs&gt; function will be called by application.&nbsp; This may be necessary if Synchronous window time was expired.</td></tr><tr><td class=CDLEntry>transmittingAborted</td><td class=CDLDescription>If true, CAN transmit buffer was just aborted.</td></tr><tr><td class=CDLEntry>firstCANtxMessage</td><td class=CDLDescription>Equal to 1, when the first transmitted message (bootup message) is in CAN TX buffers.</td></tr><tr><td class=CDLEntry>CANtxCount</td><td class=CDLDescription>Number of messages in transmit buffer, which are waiting to be copied to CAN module.</td></tr><tr><td class=CDLEntry>errOld</td><td class=CDLDescription>Previous state of CAN errors.</td></tr><tr><td class=CDLEntry>EM</td><td class=CDLDescription>Pointer to Emergency object <a href="../CO_Emergency-h.html#CO_emergencyReport_t" class=LVariable id=link44 onMouseOver="ShowTip(event, 'tt23', 'link44')" onMouseOut="HideTip('tt23')">CO_emergencyReport_t</a>.</td></tr></table></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Functions"></a>Functions</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="memcpySwapN"></a>memcpySwapN</h3><div class=CBody><p>Copy N data bytes from source to destination.&nbsp; Swap bytes if necessary.&nbsp; CANopen uses little endian. dsPIC33F and PIC24H with Microchip C30 uses little endian.&nbsp; Functions just copy bytes without inversion.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>dest</td><td class=CDLDescription>Destination location.</td></tr><tr><td class=CDLEntry>src</td><td class=CDLDescription>Source location.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="Receive_CAN_message_function"></a>Receive CAN message function</h3><div class=CBody><p>Process received CAN message.</p><p>Different CANopen objects (like SDO) register their own functions, which will be called by CAN receive interrupt every time, when CAN message with matched identifier will be received.&nbsp; Function is then responsible to verify some basics, like message length or overflow.&nbsp; It must copy message contents to objects buffer.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>object</td><td class=CDLDescription>Pointer to object registered by <a href="#CO_CANrxBufferInit" class=LFunction id=link45 onMouseOver="ShowTip(event, 'tt12', 'link45')" onMouseOut="HideTip('tt12')">CO_CANrxBufferInit</a>.</td></tr><tr><td class=CDLEntry>msg</td><td class=CDLDescription>Pointer to CAN message (directly on CAN module) <a href="#CO_CANrxMsg_t" class=LVariable id=link46 onMouseOver="ShowTip(event, 'tt3', 'link46')" onMouseOut="HideTip('tt3')">CO_CANrxMsg_t</a>.</td></tr></table><h4 class=CHeading>Return <a href="#CO_ReturnError" class=LConstant id=link47 onMouseOver="ShowTip(event, 'tt24', 'link47')" onMouseOut="HideTip('tt24')">CO_ReturnError</a></h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CO_ERROR_NO</td><td class=CDLDescription>Operation completed successfully.</td></tr><tr><td class=CDLEntry>CO_ERROR_RX_OVERFLOW</td><td class=CDLDescription>Previous message was not processed yet.</td></tr><tr><td class=CDLEntry>CO_ERROR_RX_PDO_OWERFLOW</td><td class=CDLDescription>previous PDO was not processed yet.</td></tr><tr><td class=CDLEntry>CO_ERROR_RX_MSG_LENGTH</td><td class=CDLDescription>Wrong receive message length.</td></tr><tr><td class=CDLEntry>CO_ERROR_RX_PDO_LENGTH</td><td class=CDLDescription>Wrong receive PDO length.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANsetConfigurationMode"></a>CO_CANsetConfigurationMode</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANsetConfigurationMode(</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameter nowrap>CANbaseAddress</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Requests CAN configuration (stopped) mode and <b>wait</b> untill it is set.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANbaseAddress</td><td class=CDLDescription>CAN module base address.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANsetNormalMode"></a>CO_CANsetNormalMode</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANsetNormalMode(</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameter nowrap>CANbaseAddress</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Requests CAN normal (opearational) mode and <b>wait</b> untill it is set.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANbaseAddress</td><td class=CDLDescription>CAN module base address.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANmodule_init"></a>CO_CANmodule_init</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>INTEGER16 CO_CANmodule_init(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>**</td><td class=PParameter nowrap>ppCANmodule,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>CANbaseAddress,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>rxSize,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>txSize,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>CANbitRate</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Initialize CAN module object.</p><p>Function must be called in the communication reset section.&nbsp; CAN module must be in Configuration Mode before.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>ppCANmodule</td><td class=CDLDescription>Pointer to address of CAN module object <a href="#CO_CANmodule_t" class=LVariable id=link48 onMouseOver="ShowTip(event, 'tt6', 'link48')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a>.&nbsp; If address is zero, memory for new object will be allocated and address will be set.</td></tr><tr><td class=CDLEntry>CANbaseAddress</td><td class=CDLDescription>CAN module base address.&nbsp; See <a href="#Peripheral_addresses" class=LConstant >Peripheral addresses</a>.</td></tr><tr><td class=CDLEntry>rxSize</td><td class=CDLDescription>Size of receive array is equal to number of receiving CAN objects.</td></tr><tr><td class=CDLEntry>txSize</td><td class=CDLDescription>Size of transmit array is equal to number of transmitting CAN objects.</td></tr><tr><td class=CDLEntry>CANbitRate</td><td class=CDLDescription>CAN bit rate.&nbsp; Valid values are (in kbps): 10, 20, 50, 125, 250, 500, 800, 1000.&nbsp; If value is illegal, bitrate defaults to 125.</td></tr></table><h4 class=CHeading>Return <a href="#CO_ReturnError" class=LConstant id=link49 onMouseOver="ShowTip(event, 'tt24', 'link49')" onMouseOut="HideTip('tt24')">CO_ReturnError</a></h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CO_ERROR_NO</td><td class=CDLDescription>Operation completed successfully.</td></tr><tr><td class=CDLEntry>CO_ERROR_ILLEGAL_ARGUMENT</td><td class=CDLDescription>Error in function arguments.</td></tr><tr><td class=CDLEntry>CO_ERROR_OUT_OF_MEMORY</td><td class=CDLDescription>Memory allocation failed.</td></tr><tr><td class=CDLEntry>CO_ERROR_ILLEGAL_BAUDRATE</td><td class=CDLDescription>Illegal baudrate passed to function <a href="#CO_CANmodule_init" class=LFunction id=link50 onMouseOver="ShowTip(event, 'tt9', 'link50')" onMouseOut="HideTip('tt9')">CO_CANmodule_init</a></td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANmodule_delete"></a>CO_CANmodule_delete</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANmodule_delete(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>**</td><td class=PParameter nowrap>ppCANmodule</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Delete CANmodule object and free memory.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>ppCANmodule</td><td class=CDLDescription>Pointer to pointer to CAN module object <a href="#CO_CANmodule_t" class=LVariable id=link51 onMouseOver="ShowTip(event, 'tt6', 'link51')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a>.&nbsp; Pointer to CAN module object is set to 0.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANrxMsg_readIdent"></a>CO_CANrxMsg_readIdent</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>UNSIGNED16 CO_CANrxMsg_readIdent(</td><td class=PType nowrap>CO_CANrxMsg_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>rxMsg</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Reads CAN identifier from received message.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>rxMsg</td><td class=CDLDescription>Pointer to received message.&nbsp; See <a href="#CO_CANrxMsg_t" class=LVariable id=link52 onMouseOver="ShowTip(event, 'tt3', 'link52')" onMouseOut="HideTip('tt3')">CO_CANrxMsg_t</a>.</td></tr></table><h4 class=CHeading>Return</h4><p>11-bit CAN standard identifier.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANrxBufferInit"></a>CO_CANrxBufferInit</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters colspan=4>INTEGER16 CO_CANrxBufferInit(</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap width=100%>CANmodule,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>index,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>ident,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>mask,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>rtr,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>void&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap width=100%>object,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>INTEGER16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>(*pFunct)(void *object, CO_CANrxMsg_t *message)</td></tr><tr><td class=PAfterParameters colspan=4>)</td></tr></table></td></tr></table></blockquote><p>Configure CAN message receive buffer.</p><p>Function configures specific CAN receive buffer.&nbsp; It sets CAN identifier and connects buffer with specific object.&nbsp; For more information see topic <a href="#Reception_of_CAN_messages" class=LGeneric id=link53 onMouseOver="ShowTip(event, 'tt25', 'link53')" onMouseOut="HideTip('tt25')">Reception of CAN messages</a>.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANmodule</td><td class=CDLDescription>Pointer to CAN module object <a href="#CO_CANmodule_t" class=LVariable id=link54 onMouseOver="ShowTip(event, 'tt6', 'link54')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a>.</td></tr><tr><td class=CDLEntry>index</td><td class=CDLDescription>Index of CAN device receive buffer.</td></tr><tr><td class=CDLEntry>ident</td><td class=CDLDescription>11-bit standard CAN Identifier.</td></tr><tr><td class=CDLEntry>mask</td><td class=CDLDescription>11-bit mask for identifier.&nbsp; Most usually set to 0x7FF.&nbsp; Received message (rcvMsg) will be accepted if the following condition is true: (((rcvMsgId ^ ident) &amp; mask) == 0).</td></tr><tr><td class=CDLEntry>rtr</td><td class=CDLDescription>If true, &lsquo;Remote Transmit Request&rsquo; messages will be accepted.</td></tr><tr><td class=CDLEntry>object</td><td class=CDLDescription>CANopen object, to which buffer is connected.&nbsp; It will be used as an argument to pFunct.&nbsp; Its type is (void), pFunct will change its type back to the correct object type.</td></tr><tr><td class=CDLEntry>pFunct</td><td class=CDLDescription>Pointer to function, which will be called, if received CAN message matches the identifier.&nbsp; It must be fast function.&nbsp; See <a href="#Receive_CAN_message_function" class=LFunction id=link55 onMouseOver="ShowTip(event, 'tt1', 'link55')" onMouseOut="HideTip('tt1')">Receive CAN message function</a>.</td></tr></table><h4 class=CHeading>Return <a href="#CO_ReturnError" class=LConstant id=link56 onMouseOver="ShowTip(event, 'tt24', 'link56')" onMouseOut="HideTip('tt24')">CO_ReturnError</a></h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CO_ERROR_NO</td><td class=CDLDescription>Operation completed successfully.</td></tr><tr><td class=CDLEntry>CO_ERROR_ILLEGAL_ARGUMENT</td><td class=CDLDescription>Error in function arguments.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANtxBufferInit"></a>CO_CANtxBufferInit</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>CO_CANtxArray_t *CO_CANtxBufferInit(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>index,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>ident,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>rtr,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>noOfBytes,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>syncFlag</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Configure CAN message transmit buffer.</p><p>Function configures specific CAN transmit buffer.&nbsp; For more information see topic <a href="#Transmission_of_CAN_messages" class=LGeneric id=link57 onMouseOver="ShowTip(event, 'tt26', 'link57')" onMouseOut="HideTip('tt26')">Transmission of CAN messages</a>.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANmodule</td><td class=CDLDescription>Pointer to CAN module object <a href="#CO_CANmodule_t" class=LVariable id=link58 onMouseOver="ShowTip(event, 'tt6', 'link58')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a>.</td></tr><tr><td class=CDLEntry>index</td><td class=CDLDescription>Index of CAN device transmit buffer to configure.</td></tr><tr><td class=CDLEntry>ident</td><td class=CDLDescription>11-bit standard CAN Identifier.</td></tr><tr><td class=CDLEntry>rtr</td><td class=CDLDescription>If true, &lsquo;Remote Transmit Request&rsquo; messages will be transmitted.</td></tr><tr><td class=CDLEntry>noOfBytes</td><td class=CDLDescription>Length of CAN message in bytes (0 to 8 bytes).</td></tr><tr><td class=CDLEntry>syncFlag</td><td class=CDLDescription>This flag bit is used for synchronous TPDO messages.&nbsp; If it is set, message will not be sent, if curent time is outside synchronous window.</td></tr></table><h4 class=CHeading>Return</h4><p>Pointer to CAN transmit message buffer <a href="#CO_CANtxArray_t" class=LVariable id=link59 onMouseOver="ShowTip(event, 'tt5', 'link59')" onMouseOut="HideTip('tt5')">CO_CANtxArray_t</a>.&nbsp; 8 bytes data array inside buffer should be written, before <a href="#CO_CANsend" class=LFunction id=link60 onMouseOver="ShowTip(event, 'tt14', 'link60')" onMouseOut="HideTip('tt14')">CO_CANsend</a> function is called.&nbsp; Zero is returned in case of wrong arguments.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANsend"></a>CO_CANsend</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>INTEGER16 CO_CANsend(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule,</td></tr><tr><td></td><td class=PType nowrap>CO_CANtxArray_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>buffer</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Send CAN message.</p><p>For more information see topic <a href="#Transmission_of_CAN_messages" class=LGeneric id=link61 onMouseOver="ShowTip(event, 'tt26', 'link61')" onMouseOut="HideTip('tt26')">Transmission of CAN messages</a>.&nbsp; Before this function <a href="#CO_CANtxBufferInit" class=LFunction id=link62 onMouseOver="ShowTip(event, 'tt13', 'link62')" onMouseOut="HideTip('tt13')">CO_CANtxBufferInit</a> must be caled, which configures TX message buffer.&nbsp; Also 8 bytes of CAN data should be populated.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANmodule</td><td class=CDLDescription>Pointer to CAN module object <a href="#CO_CANmodule_t" class=LVariable id=link63 onMouseOver="ShowTip(event, 'tt6', 'link63')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a>.</td></tr><tr><td class=CDLEntry>buffer</td><td class=CDLDescription>Pointer to transmit buffer, returned by <a href="#CO_CANtxBufferInit" class=LFunction id=link64 onMouseOver="ShowTip(event, 'tt13', 'link64')" onMouseOut="HideTip('tt13')">CO_CANtxBufferInit</a>.</td></tr></table><h4 class=CHeading>Return <a href="#CO_ReturnError" class=LConstant id=link65 onMouseOver="ShowTip(event, 'tt24', 'link65')" onMouseOut="HideTip('tt24')">CO_ReturnError</a></h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CO_ERROR_NO</td><td class=CDLDescription>Operation completed successfully.</td></tr><tr><td class=CDLEntry>CO_ERROR_TX_OVERFLOW</td><td class=CDLDescription>Previous message is still waiting, buffer full.</td></tr><tr><td class=CDLEntry>CO_ERROR_TX_PDO_WINDOW</td><td class=CDLDescription>Synchronous TPDO is outside window.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANclearPendingSyncPDOs"></a>CO_CANclearPendingSyncPDOs</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANclearPendingSyncPDOs(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Clear all synchronous TPDOs from CAN module transmit buffers.</p><p>CANopen allows synchronous PDO communication only inside time between SYNC message and SYNC Window.&nbsp; If time is outside this window, new synch.&nbsp; PDOs must not be sent and all pending sync TPDOs, which may be on CAN TX buffers, must be cleared.</p><p>This function checks (and aborts transmission if necessary) CAN TX buffers when it is called.&nbsp; Function should be called by application in the moment, when SYNC time was just passed out of synchronous window.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANmodule</td><td class=CDLDescription>Pointer to CAN module object <a href="#CO_CANmodule_t" class=LVariable id=link66 onMouseOver="ShowTip(event, 'tt6', 'link66')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a>.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANverifyErrors"></a>CO_CANverifyErrors</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANverifyErrors(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Verify all errors of CAN module.</p><p>Function is called directly from <a href="../CO_Emergency-h.html#CO_emergency_process" class=LFunction id=link67 onMouseOver="ShowTip(event, 'tt27', 'link67')" onMouseOut="HideTip('tt27')">CO_emergency_process</a> function.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANmodule</td><td class=CDLDescription>Pointer to CAN module object <a href="#CO_CANmodule_t" class=LVariable id=link68 onMouseOver="ShowTip(event, 'tt6', 'link68')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a>.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_CANinterrupt"></a>CO_CANinterrupt</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANinterrupt(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>CAN interrupt receives and transmits CAN messages.</p><p>Function must be called directly from _C1Interrupt or _C2Interrupt with high priority. dsPIC30F uses two receive buffers and one transmit buffer.&nbsp; For more information see topics: <a href="#Reception_of_CAN_messages" class=LGeneric id=link69 onMouseOver="ShowTip(event, 'tt25', 'link69')" onMouseOut="HideTip('tt25')">Reception of CAN messages</a> and <a href="#Transmission_of_CAN_messages" class=LGeneric id=link70 onMouseOver="ShowTip(event, 'tt26', 'link70')" onMouseOut="HideTip('tt26')">Transmission of CAN messages</a>.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>CANmodule</td><td class=CDLDescription>Pointer to CAN module object <a href="#CO_CANmodule_t" class=LVariable id=link71 onMouseOver="ShowTip(event, 'tt6', 'link71')" onMouseOut="HideTip('tt6')">CO_CANmodule_t</a>.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CO_ODF"></a>CO_ODF</h3><div class=CBody><p>Default function for SDO server access of variables from Object Dictionary.</p><p>dsPIC30F specifics: if variable is RAM or EEPROM type, normal copy is used.&nbsp; If variable is ROM type and macro <a href="#CO_USE_FLASH_WRITE" class=LConstant id=link72 onMouseOver="ShowTip(event, 'tt28', 'link72')" onMouseOut="HideTip('tt28')">CO_USE_FLASH_WRITE</a> is defined, <a href="memcpyram2flash-h.html#memcpyram2flash" class=LFunction id=link73 onMouseOver="ShowTip(event, 'tt18', 'link73')" onMouseOut="HideTip('tt18')">memcpyram2flash</a> function is used.&nbsp; It uses microcontroler&rsquo;s self programming technique.&nbsp; CANopen and dsPIC30F uses Little endian, so no byte inversion is implemented.&nbsp; With Big endianes, bytes must be inverted if CO_ODA_MB_VALUE bit is true.</p><p>For more information see <a href="#CO_ODF" class=LFunction id=link74 onMouseOver="ShowTip(event, 'tt29', 'link74')" onMouseOut="HideTip('tt29')">CO_ODF</a> in CO_SDO.h file.</p></div></div></div>

</div><!--Content-->


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class=MEntry><div class=MFile><a href="../Readme-txt.html">CANopenNode</a></div></div><div class=MEntry><div class=MFile><a href="../application-h.html">application.h</a></div></div><div class=MEntry><div class=MFile><a href="../CANopen-h.html">CANopen.h</a></div></div><div class=MEntry><div class=MFile><a href="../CO_Emergency-h.html">CO_Emergency.h</a></div></div><div class=MEntry><div class=MFile><a href="../CO_HBconsumer-h.html">CO_HBconsumer.h</a></div></div><div class=MEntry><div class=MFile><a href="../CO_NMT_Heartbeat-h.html">CO_NMT_Heartbeat.h</a></div></div><div class=MEntry><div class=MFile><a href="../CO_PDO-h.html">CO_PDO.h</a></div></div><div class=MEntry><div class=MFile><a href="../CO_SDO-h.html">CO_SDO.h</a></div></div><div class=MEntry><div class=MFile><a href="../CO_SDOmaster-h.html">CO_SDOmaster.h</a></div></div><div class=MEntry><div class=MFile><a href="../CO_SYNC-h.html">CO_SYNC.h</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">PIC32</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MFile><a href="../PIC32/CO_driver-h.html">CO_driver.h</a></div></div><div class=MEntry><div class=MFile><a href="../PIC32/eeprom-h.html">eeprom.h</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent2')">BECK_SC2x3</a><div class=MGroupContent id=MGroupContent2><div class=MEntry><div class=MFile><a href="../BECK_SC2x3/CO_driver-h.html">CO_driver.h</a></div></div><div class=MEntry><div class=MFile><a href="../BECK_SC2x3/eeprom-h.html">eeprom.h</a></div></div><div class=MEntry><div class=MFile><a href="../BECK_SC2x3/CgiLog-h.html">CgiLog.h</a></div></div><div class=MEntry><div class=MFile><a href="../BECK_SC2x3/CgiOD-h.html">CgiOD.h</a></div></div><div class=MEntry><div class=MFile><a href="../BECK_SC2x3/CgiSend-h.html">CgiSend.h</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent3')">PIC24H_dsPIC33F</a><div class=MGroupContent id=MGroupContent3><div class=MEntry><div class=MFile><a href="../PIC24H_dsPIC33F/CO_driver-h.html">CO_driver.h</a></div></div><div class=MEntry><div class=MFile><a href="../PIC24H_dsPIC33F/eeprom-h.html">eeprom.h</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent4')">dsPIC30F</a><div class=MGroupContent id=MGroupContent4><div class=MEntry><div class=MFile id=MSelected>CO_driver.h</div></div><div class=MEntry><div class=MFile><a href="eeprom-h.html">eeprom.h</a></div></div><div class=MEntry><div class=MFile><a href="memcpyram2flash-h.html">memcpyram2flash.h</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent5')">Index</a><div class=MGroupContent id=MGroupContent5><div class=MEntry><div class=MIndex><a href="../../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Files.html">Files</a></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Files">Files</option></select></div></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CFunction>Process received CAN message.</div></div><div class=CToolTip id="tt2"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED8 scale; UNSIGNED8 BRP; UNSIGNED8 SJW; UNSIGNED8 PROP; UNSIGNED8 phSeg1; UNSIGNED8 phSeg2; }CO_CANbitRateData_t</td></tr></table></blockquote>Structure contains timing coefficients for CAN module. </div></div><div class=CToolTip id="tt3"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED16 ident; UNSIGNED16 extIdent; UNSIGNED16 DLC :4; UNSIGNED16 DLCrest :12; UNSIGNED8 data[8]; UNSIGNED16 CON; }CO_CANrxMsg_t</td></tr></table></blockquote>CAN receive message structure as aligned in CAN module. </div></div><div class=CToolTip id="tt4"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED16 ident; UNSIGNED16 mask; void *object; INTEGER16 (*pFunct)(void *object, CO_CANrxMsg_t *message); }CO_CANrxArray_t</td></tr></table></blockquote>Array for handling received CAN messages.</div></div><div class=CToolTip id="tt5"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED16 ident; UNSIGNED8 DLC; UNSIGNED8 data[8]; volatile UNSIGNED8 bufferFull; volatile UNSIGNED8 syncFlag; }CO_CANtxArray_t</td></tr></table></blockquote>Array for handling transmitting CAN messages.</div></div><div class=CToolTip id="tt6"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED16 CANbaseAddress; CO_CANrxArray_t *rxArray; UNSIGNED16 rxSize; CO_CANtxArray_t *txArray; UNSIGNED16 txSize; volatile UNSIGNED8 *curentSyncTimeIsInsideWindow; volatile UNSIGNED8 bufferInhibitFlag; volatile UNSIGNED8 transmittingAborted; volatile UNSIGNED8 firstCANtxMessage; volatile UNSIGNED16 CANtxCount; UNSIGNED8 errOld; void *EM; }CO_CANmodule_t</td></tr></table></blockquote>Object controls CAN module.</div></div><div class=CToolTip id="tt7"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANsetConfigurationMode(</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameter nowrap>CANbaseAddress</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Requests CAN configuration (stopped) mode and <b>wait</b> untill it is set.</div></div><div class=CToolTip id="tt8"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANsetNormalMode(</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameter nowrap>CANbaseAddress</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Requests CAN normal (opearational) mode and <b>wait</b> untill it is set.</div></div><div class=CToolTip id="tt9"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>INTEGER16 CO_CANmodule_init(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>**</td><td class=PParameter nowrap>ppCANmodule,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>CANbaseAddress,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>rxSize,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>txSize,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>CANbitRate</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Initialize CAN module object.</div></div><div class=CToolTip id="tt10"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANmodule_delete(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>**</td><td class=PParameter nowrap>ppCANmodule</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Delete CANmodule object and free memory.</div></div><div class=CToolTip id="tt11"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>UNSIGNED16 CO_CANrxMsg_readIdent(</td><td class=PType nowrap>CO_CANrxMsg_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>rxMsg</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Reads CAN identifier from received message.</div></div><div class=CToolTip id="tt12"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters colspan=4>INTEGER16 CO_CANrxBufferInit(</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap width=100%>CANmodule,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>index,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>ident,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>mask,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>rtr,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>void&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap width=100%>object,</td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td class=PType nowrap>INTEGER16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap width=100%>(*pFunct)(void *object, CO_CANrxMsg_t *message)</td></tr><tr><td class=PAfterParameters colspan=4>)</td></tr></table></td></tr></table></blockquote>Configure CAN message receive buffer.</div></div><div class=CToolTip id="tt13"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>CO_CANtxArray_t *CO_CANtxBufferInit(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>index,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>ident,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>rtr,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>noOfBytes,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>syncFlag</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Configure CAN message transmit buffer.</div></div><div class=CToolTip id="tt14"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>INTEGER16 CO_CANsend(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule,</td></tr><tr><td></td><td class=PType nowrap>CO_CANtxArray_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>buffer</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Send CAN message.</div></div><div class=CToolTip id="tt15"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANclearPendingSyncPDOs(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Clear all synchronous TPDOs from CAN module transmit buffers.</div></div><div class=CToolTip id="tt16"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANverifyErrors(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Verify all errors of CAN module.</div></div><div class=CToolTip id="tt17"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_CANinterrupt(</td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANmodule</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>CAN interrupt receives and transmits CAN messages.</div></div><div class=CToolTip id="tt18"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void memcpyram2flash(</td><td class=PTypePrefix nowrap>const&nbsp;</td><td class=PType nowrap>void&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>dest,</td></tr><tr><td></td><td class=PTypePrefix nowrap></td><td class=PType nowrap>void&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>src,</td></tr><tr><td></td><td class=PTypePrefix nowrap>unsigned&nbsp;</td><td class=PType nowrap>int&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>memsize</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Copies contents of RAM variable into Flash program memory space.</div></div><div class=CToolTip id="tt19"><div class=CGeneric>Usage of device file system or SRAM for storing non-volatile variables.</div></div><div class=CToolTip id="tt20"><div class=CMacro>CAN bit rates are initializers for array of eight CO_CANbitRateData_t objects.</div></div><div class=CToolTip id="tt21"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ CO_emergencyReport_t *EM; UNSIGNED8 *operatingState; UNSIGNED8 isProducer; UNSIGNED16 COB_ID; UNSIGNED32 periodTime; UNSIGNED32 periodTimeoutTime; UNSIGNED8 counterOverflowValue; UNSIGNED8 curentSyncTimeIsInsideWindow; UNSIGNED32 running; UNSIGNED32 timer; UNSIGNED8 counter; CO_CANmodule_t *CANdevRx; UNSIGNED16 CANdevRxIdx; CO_CANmodule_t *CANdevTx; CO_CANtxArray_t *CANtxBuff; UNSIGNED16 CANdevTxIdx; }CO_SYNC_t</td></tr></table></blockquote>Object controls SYNC producer and consumer.</div></div><div class=CToolTip id="tt22"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>INTEGER16 CO_SYNC_init(</td><td class=PType nowrap>CO_SYNC_t&nbsp;</td><td class=PParameterPrefix nowrap>**</td><td class=PParameter nowrap>ppSYNC,</td></tr><tr><td></td><td class=PType nowrap>CO_emergencyReport_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>EM,</td></tr><tr><td></td><td class=PType nowrap>CO_SDO_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>SDO,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>operatingState,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED32&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>ObjDict_COB_ID_SYNCMessage,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED32&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>ObjDict_communicationCyclePeriod,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>ObjDict_synchronousCounterOverflowValue,</td></tr><tr><td></td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANdevRx,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>CANdevRxIdx,</td></tr><tr><td></td><td class=PType nowrap>CO_CANmodule_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>CANdevTx,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>CANdevTxIdx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Initialize SYNC object.</div></div><div class=CToolTip id="tt23"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>typedef struct{ UNSIGNED8 *errorStatusBits; UNSIGNED8 errorStatusBitsSize; UNSIGNED8 *msgBuffer; UNSIGNED8 *msgBufferEnd; UNSIGNED8 *msgBufferWritePtr; UNSIGNED8 *msgBufferReadPtr; UNSIGNED8 msgBufferFull; UNSIGNED8 wrongErrorReport; UNSIGNED8 errorReportBusy; UNSIGNED8 errorReportBusyError; }CO_emergencyReport_t</td></tr></table></blockquote>Object contains error buffer, to which new emergency messages are written, when CO_errorReport function is called. </div></div><div class=CToolTip id="tt24"><div class=CConstant>Return values of most CANopen functions. </div></div><div class=CToolTip id="tt25"><div class=CGeneric>Received message is processed by Receive CAN message function.</div></div><div class=CToolTip id="tt26"><div class=CGeneric>CAN device has number of transmit buffers equal to number of different CANopen transmitting objects. </div></div><div class=CToolTip id="tt27"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>void CO_emergency_process(</td><td class=PType nowrap>CO_emergencyProcess_t&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>EMpr,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED8&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>NMTisPreOrOperational,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>timeDifference_100us,</td></tr><tr><td></td><td class=PType nowrap>UNSIGNED16&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>EMinhTime</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Process Emergency object.</div></div><div class=CToolTip id="tt28"><div class=CConstant>If defined, then memcpyram2flash will be used to save ROM variables from Object Dictionary into internal flash memory. </div></div><div class=CToolTip id="tt29"><div class=CFunction>Default function for SDO server access of variables from Object Dictionary.</div></div><!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>